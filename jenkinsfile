pipeline {
    agent any

    stages {
        stage('Run docker nginx') {
            steps {
                sh 'sudo mkdir -p /usr/share/nginx/html'
                sh 'sudo cp ./www/index.html /usr/share/nginx/html/index.html'
                sh 'docker-compose up -d'
            }
        }

        stage('HTTP Request'){
            steps {
                url = 'http://localhost:9889'
                int status = sh(script: "curl -sLI -w '%{http_code}' $url -o /dev/null", returnStdout: true)
                if (status == 200) {
                    echo "It's ok"
                }

            }
        }

        stage('Stop and del nginx container'){
            steps {
                sh 'docker stop new_project11_nginx_1'
                sh 'docker rm new_project11_nginx_1'
            }
        }
    }
}