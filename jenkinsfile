pipeline {
    agent any

    stages {
        stage('Run docker nginx') {
            steps {
                sh 'sudo mkdir -p /usr/share/nginx/html'
                sh 'sudo cp ./www/index.html /usr/share/nginx/html/index.html'
                sh 'docker-compose up -d'
            }
        }

        stage('HTTP Request'){
            steps {
                script {
                    final String url = 'http://localhost:9889'
                        final def (String response, String code) =
                            sh(script: "curl -s -w '\\n%{response_code}' $url", returnStdout: true)
                                .trim()
                                .tokenize("\n")

                        echo "HTTP response status code: $code"

                        if (code == '200') {
                            echo code
                        }

                }

            }
        }

        stage('Stop and del nginx container'){
            steps {
                sh 'docker stop new_project11_nginx_1'
                sh 'docker rm new_project11_nginx_1'
            }
        }
    }
}