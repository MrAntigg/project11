pipeline {
    agent any

    stages {
        stage('Run docker nginx') {
            steps {
                sh 'sudo mkdir -p /usr/share/nginx/html'
                sh 'sudo cp ./www/index.html /usr/share/nginx/html/index.html'
                sh 'docker-compose up -d'
            }
        }

        stage('HTTP Request'){
            steps {
                script {
                    final String url = 'http://localhost:9889'
                        final def (String response, int code) =
                            sh(script: "curl -s -w '\\n%{response_code}' $url", returnStdout: true)
                                .trim()
                        echo "HTTP response status code: $code"

                        if (code == 200) {
                            echo response
                        }

                }

            }
        }
    }
}